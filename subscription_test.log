2025-11-15 17:52:55,257 - asyncio - DEBUG - Using proactor: IocpProactor
2025-11-15 17:52:55,614 - bot - INFO - Bot initialized successfully
2025-11-15 17:52:55,760 - tortoise - DEBUG - Tortoise-ORM startup
    connections: {'default': {'engine': 'tortoise.backends.sqlite', 'credentials': {'journal_mode': 'WAL', 'journal_size_limit': 16384, 'file_path': 'db.sqlite3'}}}
    apps: {'models': {'models': ['database.models.giveaway', 'database.models.telegram_channel', 'database.models.giveaway_statistic', 'database.models.temporary_users'], 'default_connection': 'default'}}
2025-11-15 17:52:55,773 - tortoise - DEBUG - Creating schema: CREATE TABLE IF NOT EXISTS "giveaway" (
    "owner_id" BIGINT NOT NULL,
    "run_status" INT NOT NULL,
    "type" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "callback_value" TEXT NOT NULL PRIMARY KEY,
    "text" TEXT NOT NULL,
    "photo_id" TEXT,
    "video_id" TEXT,
    "over_date" TIMESTAMP NOT NULL,
    "captcha" INT NOT NULL,
    "winners_count" INT NOT NULL
);
CREATE TABLE IF NOT EXISTS "telegramchannel" (
    "channel_id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
    "group_id" BIGINT,
    "post_id" BIGINT,
    "owner_id" BIGINT NOT NULL,
    "give_callback_value" TEXT NOT NULL,
    "channel_callback_value" TEXT NOT NULL,
    "name" TEXT NOT NULL
);
CREATE TABLE IF NOT EXISTS "giveawaystatistic" (
    "giveaway_callback_value" TEXT NOT NULL PRIMARY KEY,
    "members" JSON,
    "post_link" TEXT NOT NULL,
    "winners" JSON
);
CREATE TABLE IF NOT EXISTS "temporaryusers" (
    "giveaway_callback_value" TEXT NOT NULL PRIMARY KEY,
    "users" JSON
);
2025-11-15 17:52:55,774 - aiosqlite - DEBUG - executing <function connect.<locals>.connector at 0x000001666E359C60>
2025-11-15 17:52:55,775 - aiosqlite - DEBUG - operation <function connect.<locals>.connector at 0x000001666E359C60> completed
2025-11-15 17:52:55,776 - aiosqlite - DEBUG - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000001666F33EC40>, 'PRAGMA journal_mode=WAL', [])
2025-11-15 17:52:55,776 - aiosqlite - DEBUG - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000001666F33EC40>, 'PRAGMA journal_mode=WAL', []) completed
2025-11-15 17:52:55,777 - aiosqlite - DEBUG - executing functools.partial(<built-in method close of sqlite3.Cursor object at 0x000001666FE1FB40>)
2025-11-15 17:52:55,777 - aiosqlite - DEBUG - operation functools.partial(<built-in method close of sqlite3.Cursor object at 0x000001666FE1FB40>) completed
2025-11-15 17:52:55,777 - aiosqlite - DEBUG - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000001666F33EC40>, 'PRAGMA journal_size_limit=16384', [])
2025-11-15 17:52:55,777 - aiosqlite - DEBUG - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000001666F33EC40>, 'PRAGMA journal_size_limit=16384', []) completed
2025-11-15 17:52:55,778 - aiosqlite - DEBUG - executing functools.partial(<built-in method close of sqlite3.Cursor object at 0x000001666FE1FBC0>)
2025-11-15 17:52:55,778 - aiosqlite - DEBUG - operation functools.partial(<built-in method close of sqlite3.Cursor object at 0x000001666FE1FBC0>) completed
2025-11-15 17:52:55,778 - aiosqlite - DEBUG - executing functools.partial(<built-in method execute of sqlite3.Connection object at 0x000001666F33EC40>, 'PRAGMA foreign_keys=ON', [])
2025-11-15 17:52:55,778 - aiosqlite - DEBUG - operation functools.partial(<built-in method execute of sqlite3.Connection object at 0x000001666F33EC40>, 'PRAGMA foreign_keys=ON', []) completed
2025-11-15 17:52:55,778 - aiosqlite - DEBUG - executing functools.partial(<built-in method close of sqlite3.Cursor object at 0x000001666FE1FB40>)
2025-11-15 17:52:55,779 - aiosqlite - DEBUG - operation functools.partial(<built-in method close of sqlite3.Cursor object at 0x000001666FE1FB40>) completed
2025-11-15 17:52:55,779 - tortoise.db_client - DEBUG - Created connection <Connection(Thread-1, started 15520)> with params: filename=db.sqlite3 journal_mode=WAL journal_size_limit=16384 foreign_keys=ON
2025-11-15 17:52:55,779 - tortoise.db_client - DEBUG - CREATE TABLE IF NOT EXISTS "giveaway" (
    "owner_id" BIGINT NOT NULL,
    "run_status" INT NOT NULL,
    "type" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "callback_value" TEXT NOT NULL PRIMARY KEY,
    "text" TEXT NOT NULL,
    "photo_id" TEXT,
    "video_id" TEXT,
    "over_date" TIMESTAMP NOT NULL,
    "captcha" INT NOT NULL,
    "winners_count" INT NOT NULL
);
CREATE TABLE IF NOT EXISTS "telegramchannel" (
    "channel_id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
    "group_id" BIGINT,
    "post_id" BIGINT,
    "owner_id" BIGINT NOT NULL,
    "give_callback_value" TEXT NOT NULL,
    "channel_callback_value" TEXT NOT NULL,
    "name" TEXT NOT NULL
);
CREATE TABLE IF NOT EXISTS "giveawaystatistic" (
    "giveaway_callback_value" TEXT NOT NULL PRIMARY KEY,
    "members" JSON,
    "post_link" TEXT NOT NULL,
    "winners" JSON
);
CREATE TABLE IF NOT EXISTS "temporaryusers" (
    "giveaway_callback_value" TEXT NOT NULL PRIMARY KEY,
    "users" JSON
);
2025-11-15 17:52:55,779 - aiosqlite - DEBUG - executing functools.partial(<built-in method executescript of sqlite3.Connection object at 0x000001666F33EC40>, 'CREATE TABLE IF NOT EXISTS "giveaway" (\n    "owner_id" BIGINT NOT NULL,\n    "run_status" INT NOT NULL,\n    "type" TEXT NOT NULL,\n    "name" TEXT NOT NULL,\n    "callback_value" TEXT NOT NULL PRIMARY KEY,\n    "text" TEXT NOT NULL,\n    "photo_id" TEXT,\n    "video_id" TEXT,\n    "over_date" TIMESTAMP NOT NULL,\n    "captcha" INT NOT NULL,\n    "winners_count" INT NOT NULL\n);\nCREATE TABLE IF NOT EXISTS "telegramchannel" (\n    "channel_id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,\n    "group_id" BIGINT,\n    "post_id" BIGINT,\n    "owner_id" BIGINT NOT NULL,\n    "give_callback_value" TEXT NOT NULL,\n    "channel_callback_value" TEXT NOT NULL,\n    "name" TEXT NOT NULL\n);\nCREATE TABLE IF NOT EXISTS "giveawaystatistic" (\n    "giveaway_callback_value" TEXT NOT NULL PRIMARY KEY,\n    "members" JSON,\n    "post_link" TEXT NOT NULL,\n    "winners" JSON\n);\nCREATE TABLE IF NOT EXISTS "temporaryusers" (\n    "giveaway_callback_value" TEXT NOT NULL PRIMARY KEY,\n    "users" JSON\n);')
2025-11-15 17:52:55,779 - aiosqlite - DEBUG - operation functools.partial(<built-in method executescript of sqlite3.Connection object at 0x000001666F33EC40>, 'CREATE TABLE IF NOT EXISTS "giveaway" (\n    "owner_id" BIGINT NOT NULL,\n    "run_status" INT NOT NULL,\n    "type" TEXT NOT NULL,\n    "name" TEXT NOT NULL,\n    "callback_value" TEXT NOT NULL PRIMARY KEY,\n    "text" TEXT NOT NULL,\n    "photo_id" TEXT,\n    "video_id" TEXT,\n    "over_date" TIMESTAMP NOT NULL,\n    "captcha" INT NOT NULL,\n    "winners_count" INT NOT NULL\n);\nCREATE TABLE IF NOT EXISTS "telegramchannel" (\n    "channel_id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,\n    "group_id" BIGINT,\n    "post_id" BIGINT,\n    "owner_id" BIGINT NOT NULL,\n    "give_callback_value" TEXT NOT NULL,\n    "channel_callback_value" TEXT NOT NULL,\n    "name" TEXT NOT NULL\n);\nCREATE TABLE IF NOT EXISTS "giveawaystatistic" (\n    "giveaway_callback_value" TEXT NOT NULL PRIMARY KEY,\n    "members" JSON,\n    "post_link" TEXT NOT NULL,\n    "winners" JSON\n);\nCREATE TABLE IF NOT EXISTS "temporaryusers" (\n    "giveaway_callback_value" TEXT NOT NULL PRIMARY KEY,\n    "users" JSON\n);') completed
2025-11-15 17:52:55,780 - __main__ - INFO - Database initialized
2025-11-15 17:52:55,780 - aiogram - DEBUG - Make request: "getMe" with data: "{}" and files "None"
2025-11-15 17:52:56,158 - aiogram - DEBUG - Response for getMe: [200] "'{"ok":true,"result":{"id":8500740359,"is_bot":true,"first_name":"test","username":"testolegavpopubot","can_join_groups":true,"can_read_all_group_messages":false,"supports_inline_queries":false,"can_connect_to_business":false,"has_main_web_app":false}}'"
2025-11-15 17:52:56,159 - __main__ - INFO - Bot connected: @testolegavpopubot
2025-11-15 17:52:56,159 - tortoise.db_client - DEBUG - SELECT "channel_id" "channel_id","name" "name","owner_id" "owner_id","give_callback_value" "give_callback_value" FROM "telegramchannel": []
2025-11-15 17:52:56,159 - aiosqlite - DEBUG - executing functools.partial(<bound method Connection._execute_fetchall of <Connection(Thread-1, started 15520)>>, 'SELECT "channel_id" "channel_id","name" "name","owner_id" "owner_id","give_callback_value" "give_callback_value" FROM "telegramchannel"', [])
2025-11-15 17:52:56,159 - aiosqlite - DEBUG - operation functools.partial(<bound method Connection._execute_fetchall of <Connection(Thread-1, started 15520)>>, 'SELECT "channel_id" "channel_id","name" "name","owner_id" "owner_id","give_callback_value" "give_callback_value" FROM "telegramchannel"', []) completed
2025-11-15 17:52:56,160 - __main__ - INFO - Testing user ID: 8500740359
2025-11-15 17:52:56,161 - __main__ - INFO - Testing channel -1003180113623 for user 8500740359
2025-11-15 17:52:56,161 - handlers.admin.functions_for_active_gives.check_channels_subscriptions - DEBUG - Getting status for user 8500740359 in channel -1003180113623
2025-11-15 17:52:56,161 - aiogram - DEBUG - Make request: "getChatMember" with data: "{'chat_id': -1003180113623, 'user_id': 8500740359}" and files "None"
2025-11-15 17:52:56,248 - aiogram - DEBUG - Response for getChatMember: [200] "'{"ok":true,"result":{"user":{"id":8500740359,"is_bot":true,"first_name":"test","username":"testolegavpopubot"},"status":"administrator","can_be_edited":false,"can_manage_chat":true,"can_change_info":true,"can_post_messages":true,"can_edit_messages":true,"can_delete_messages":true,"can_invite_users":true,"can_restrict_members":true,"can_promote_members":false,"can_manage_video_chats":true,"can_post_stories":true,"can_edit_stories":true,"can_delete_stories":true,"can_manage_direct_messages":true,"is_anonymous":false,"can_manage_voice_chats":true}}'"
2025-11-15 17:52:56,248 - handlers.admin.functions_for_active_gives.check_channels_subscriptions - DEBUG - User 8500740359 status in -1003180113623: administrator
2025-11-15 17:52:56,249 - __main__ - INFO - User 8500740359 status in -1003180113623: administrator
2025-11-15 17:52:56,249 - handlers.admin.functions_for_active_gives.check_channels_subscriptions - INFO - Single channel check: user 8500740359 in channel -1003180113623
2025-11-15 17:52:56,249 - aiogram - DEBUG - Make request: "getChatMember" with data: "{'chat_id': -1003180113623, 'user_id': 8500740359}" and files "None"
2025-11-15 17:52:56,325 - aiogram - DEBUG - Response for getChatMember: [200] "'{"ok":true,"result":{"user":{"id":8500740359,"is_bot":true,"first_name":"test","username":"testolegavpopubot"},"status":"administrator","can_be_edited":false,"can_manage_chat":true,"can_change_info":true,"can_post_messages":true,"can_edit_messages":true,"can_delete_messages":true,"can_invite_users":true,"can_restrict_members":true,"can_promote_members":false,"can_manage_video_chats":true,"can_post_stories":true,"can_edit_stories":true,"can_delete_stories":true,"can_manage_direct_messages":true,"is_anonymous":false,"can_manage_voice_chats":true}}'"
2025-11-15 17:52:56,325 - handlers.admin.functions_for_active_gives.check_channels_subscriptions - INFO - Single channel result: user 8500740359 status 'administrator' in -1003180113623 -> True
2025-11-15 17:52:56,325 - __main__ - INFO - Single subscription check result: True
2025-11-15 17:52:56,327 - tortoise.db_client - DEBUG - SELECT "owner_id" "owner_id" FROM "giveaway" WHERE "callback_value"=?: ['MKw3eauV3ttiShf8tkVqYy48HoM8TDyKwFEzssCV']
2025-11-15 17:52:56,327 - aiosqlite - DEBUG - executing functools.partial(<bound method Connection._execute_fetchall of <Connection(Thread-1, started 15520)>>, 'SELECT "owner_id" "owner_id" FROM "giveaway" WHERE "callback_value"=?', ['MKw3eauV3ttiShf8tkVqYy48HoM8TDyKwFEzssCV'])
2025-11-15 17:52:56,327 - aiosqlite - DEBUG - operation functools.partial(<bound method Connection._execute_fetchall of <Connection(Thread-1, started 15520)>>, 'SELECT "owner_id" "owner_id" FROM "giveaway" WHERE "callback_value"=?', ['MKw3eauV3ttiShf8tkVqYy48HoM8TDyKwFEzssCV']) completed
2025-11-15 17:52:56,328 - tortoise.db_client - DEBUG - SELECT "channel_id" "channel_id","name" "name","post_id" "post_id","group_id" "group_id" FROM "telegramchannel" WHERE "owner_id"=?: [5935366564]
2025-11-15 17:52:56,328 - aiosqlite - DEBUG - executing functools.partial(<bound method Connection._execute_fetchall of <Connection(Thread-1, started 15520)>>, 'SELECT "channel_id" "channel_id","name" "name","post_id" "post_id","group_id" "group_id" FROM "telegramchannel" WHERE "owner_id"=?', [5935366564])
2025-11-15 17:52:56,328 - aiosqlite - DEBUG - operation functools.partial(<bound method Connection._execute_fetchall of <Connection(Thread-1, started 15520)>>, 'SELECT "channel_id" "channel_id","name" "name","post_id" "post_id","group_id" "group_id" FROM "telegramchannel" WHERE "owner_id"=?', [5935366564]) completed
2025-11-15 17:52:56,328 - handlers.admin.functions_for_active_gives.check_channels_subscriptions - INFO - Checking subscription for user 8500740359 in 1 channels
2025-11-15 17:52:56,329 - handlers.admin.functions_for_active_gives.check_channels_subscriptions - INFO - Checking user 8500740359 in channel -1003180113623
2025-11-15 17:52:56,329 - aiogram - DEBUG - Make request: "getChatMember" with data: "{'chat_id': -1003180113623, 'user_id': 8500740359}" and files "None"
2025-11-15 17:52:56,404 - aiogram - DEBUG - Response for getChatMember: [200] "'{"ok":true,"result":{"user":{"id":8500740359,"is_bot":true,"first_name":"test","username":"testolegavpopubot"},"status":"administrator","can_be_edited":false,"can_manage_chat":true,"can_change_info":true,"can_post_messages":true,"can_edit_messages":true,"can_delete_messages":true,"can_invite_users":true,"can_restrict_members":true,"can_promote_members":false,"can_manage_video_chats":true,"can_post_stories":true,"can_edit_stories":true,"can_delete_stories":true,"can_manage_direct_messages":true,"is_anonymous":false,"can_manage_voice_chats":true}}'"
2025-11-15 17:52:56,405 - handlers.admin.functions_for_active_gives.check_channels_subscriptions - INFO - User 8500740359 has status 'administrator' in channel -1003180113623
2025-11-15 17:52:56,405 - handlers.admin.functions_for_active_gives.check_channels_subscriptions - INFO - âœ… User 8500740359 is properly subscribed to channel -1003180113623
2025-11-15 17:52:56,405 - handlers.admin.functions_for_active_gives.check_channels_subscriptions - INFO - User 8500740359 is subscribed to all required channels
2025-11-15 17:52:56,405 - __main__ - INFO - Giveaway participation check for MKw3eauV3ttiShf8tkVqYy48HoM8TDyKwFEzssCV: True
2025-11-15 17:52:56,407 - asyncio - DEBUG - Using proactor: IocpProactor
2025-11-15 17:52:56,420 - __main__ - INFO - Simulating comment participation for user 12345
2025-11-15 17:52:56,420 - handlers.admin.functions_for_active_gives.handle_group_users - ERROR - AttributeError in handle_new_users_in_groups: 'NoneType' object has no attribute 'id'
2025-11-15 17:52:56,420 - __main__ - WARNING - Bot did not reply to participation message
